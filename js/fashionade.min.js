var FASHIONADE=function($w){var $=function(e){return document.querySelector(e)},$$=function(e){return document.querySelectorAll(e)},get=function(url,cb){var xmlhttp;xmlhttp=new XMLHttpRequest,xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status&&cb(eval(xmlhttp.responseText))},xmlhttp.open("GET",url,!0),xmlhttp.send()},post=function(e,n){var t;(t=new XMLHttpRequest).onreadystatechange=function(){4==t.readyState&&200==t.status&&console.log("succeed",request.responseText)},t.open("POST",e,!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(n))},strTitle=function(e,n){for(var t="",a=0,i=e.length;a<i;++a)t+='<li class="'+(0===a?"on":"")+'" onClick="'+function(e,n){return"overlay"===n?"FASHIONADE.RECOMMEND_LAYER_POSITION("+(e+1)+");FASHIONADE.LOGS('click', 'STYLE"+(e+1)+"');":"FASHIONADE.RECOMMEND_POSITION("+(e+1)+");FASHIONADE.LOGS('click', 'STYLE"+(e+1)+"');"}(a,n)+'">'+e[a].name+"</li>";return'<ul class="fashionade--recommendTitleList">'+t+"</ul>"},strContent=function(e,n){for(var t="",a=0,i=e.length;a<i;++a)t+="<li>"+("overlay"===n?strmainImage(e[a].images):"")+strItems(e[a].items)+"</li>";return'<ul class="fashionade--recommendContentList">'+t+"</ul>"},strmainImage=function(e){return'<div class="fashionade--mainImageWrap">                 <div class="fashionade--mainImage"><img src="'+e[0]+'" height="424" alt="" /></div>                 </div>'},strItems=function(e){for(var n="",t=0,a=Math.min(e.length,3);t<a;++t)n+='<li class="fashionade--item">                 <div class="fashionade--thumb" style="background-image:url(\''+e[t].imageUrl+'\')"><a href="'+e[t].detailUrl+'" target="FROM_FASHIONADE_SDK" onclick="FASHIONADE.LOGS(\'click\', \'THUMBNAIL'+(t+1)+"')\">"+e[t].name+'</a></div>                 <div class="fashionade--content">                   <dl>                     <dt class="fashionade--brand"><a href="'+e[t].detailUrl+'" target="FROM_FASHIONADE_SDK" onclick="FASHIONADE.LOGS(\'click\', \'BRAND'+(t+1)+"')\">"+e[t].brand+'</a></dt>                     <dd class="fashionade--name"><a href="'+e[t].detailUrl+'" target="FROM_FASHIONADE_SDK" onclick="FASHIONADE.LOGS(\'click\', \'NAME'+(t+1)+"')\">"+e[t].name+"</a></dd>                   </dl>                 </div>           </li>";return'<div class="fashionade--itemList"><ul>'+n+"</ul></div>"},RECOMMEND={INDEX:1,LAYER_INDEX:1,direct:function(e){RECOMMEND.show(RECOMMEND.INDEX+=e)},position:function(e){RECOMMEND.show(RECOMMEND.INDEX=e)},show:function(e){var n=$$(".fashionade--renderWrap .fashionade--recommendTitleList > li"),t=$$(".fashionade--renderWrap .fashionade--recommendContentList > li");e>t.length&&(RECOMMEND.INDEX=1),e<1&&(RECOMMEND.INDEX=t.length);for(var a=0,i=t.length;a<i;++a)t[a].style.display="none",n[a].className="";t[RECOMMEND.INDEX-1].style.display="block",n[RECOMMEND.INDEX-1].className="on"},layer_direct:function(e){RECOMMEND.layer_show(RECOMMEND.LAYER_INDEX+=e)},layer_position:function(e){RECOMMEND.layer_show(RECOMMEND.LAYER_INDEX=e)},layer_show:function(e){var n=$$(".fashionade--layerWrap .fashionade--recommendTitleList > li"),t=$$(".fashionade--layerWrap .fashionade--recommendContentList > li");e>t.length&&(RECOMMEND.LAYER_INDEX=1),e<1&&(RECOMMEND.LAYER_INDEX=t.length);for(var a=0,i=t.length;a<i;++a)t[a].style.display="none",n[a].className="";t[RECOMMEND.LAYER_INDEX-1].style.display="block",n[RECOMMEND.LAYER_INDEX-1].className="on"},layer_remove:function(){$('[data-fashionade-render-recommend-type="overlay"]').innerHTML=""},showMainImage:function(e,n){for(var t=e.parentNode.getElementsByTagName("li"),a=new Image,i=0,o=t.length;i<o;++i)t[i].className="";e.className="on",a.onload=function(){e.parentNode.parentNode.childNodes[3].childNodes[0].src=n},a.src=n}},getParam=function(){var e={};return window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,(function(n,t,a){e[t]=a})),e},getMadUuid=function(){if(localStorage.getItem("madUuid"))return localStorage.getItem("madUuid");var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var n=16*Math.random()|0;return("x"==e?n:3&n|8).toString(16)}));return localStorage.setItem("madUuid",e),e},config={apiParams:{productId:getParam().productId||getParam().product_no||location.pathname.split("/")[3]||"",madUuid:getMadUuid()}},genLogData=function(e,n){return{type:e,apiKey:config.apiParams.apiKey,appKey:config.apiParams.appKey,uuid:getMadUuid(),userAgent:navigator.userAgent,lang:navigator.language,page:location.href,referrer:document.referrer,windowName:window.name,ext:config.logExt,deviceTime:new Date,eventPosition:void 0!==n?n:""}},postLogs=function(e,n){post("https://admin.fashionade.ai/logs",genLogData(e,n))},utils={jsonToParams:function(e){var n="?";for(var t in e)n+=encodeURIComponent(t)+"="+encodeURIComponent(e[t])+"&";return n.substring(0,n.length-1)}},cache={},tmpl=function(e,n){var t=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):cache[e]=cache[e]||tmpl(document.getElementById(e).innerHTML);return n?t(n):t},render=function(e,n){get(config.apiUrl+utils.jsonToParams(config.apiParams),(function(t){FASHIONADE.LOGS("init");var a=1!==t.length||0!==t[0].items.length;t.length>0&&a&&(e&&n?(document.getElementById(e).innerHTML=tmpl(n,{data:t}),FASHIONADE.LOGS("render custom template")):($('[data-fashionade-render-recommend-type="overlay"]')&&$('[data-fashionade-open-layer="recommend"]')&&($('[data-fashionade-open-layer="recommend"]').onclick=function(e){e.stopPropagation(),$('[data-fashionade-render-recommend-type="overlay"]').innerHTML='<div class="fashionade--layerWrap"><div class="fashionade--layerInnerWrap">'+strTitle(t,"overlay")+strContent(t,"overlay")+(t.length>1?"<button class=\"fashionade--btn fashionade--prev\" onClick=\"FASHIONADE.RECOMMEND_LAYER_DIRECT(-1);FASHIONADE.LOGS('click', 'PREV');\">이전 추천보기</button>                         <button class=\"fashionade--btn fashionade--next\" onClick=\"FASHIONADE.RECOMMEND_LAYER_DIRECT(1);FASHIONADE.LOGS('click', 'NEXT');\">다음 추천보기</button>":"")+'<button class="fashionade--btn fashionade--close" onClick="FASHIONADE.RECOMMEND_LAYER_REMOVE()">닫기</button></div></div>                                 <div class="fashionade--dimmed" onClick="FASHIONADE.RECOMMEND_LAYER_REMOVE()"></div>',FASHIONADE.LOGS("open")}),$('[data-fashionade-render-recommend-type="render"]')&&($('[data-fashionade-render-recommend-type="render"]').innerHTML='<div class="fashionade--renderWrap">'+strTitle(t)+strContent(t)+(t.length>1?"<button class=\"fashionade--btn fashionade--prev\" onClick=\"FASHIONADE.RECOMMEND_DIRECT(-1);FASHIONADE.LOGS('click', 'PREV');\">이전 추천보기</button>                     <button class=\"fashionade--btn fashionade--next\" onClick=\"FASHIONADE.RECOMMEND_DIRECT(1);FASHIONADE.LOGS('click', 'NEXT');\">다음 추천보기</button>":"")+"</div>",FASHIONADE.LOGS("render default template")),$(".fashionade--btn-overlay")&&($(".fashionade--btn-overlay").style.display="block")))}))},attachLogEventToButtons=function(){$$(".btnBuyUl .btn-buy a").length>0&&$$(".btnBuyUl .btn-buy a")[0].addEventListener("click",(function(){FASHIONADE.LOGS("buy")})),$$(".btnBuyUl .btn-se a").length>0&&($$(".btnBuyUl .btn-se a")[0].addEventListener("click",(function(){FASHIONADE.LOGS("cart")})),$$(".btnBuyUl .btn-se a")[1].addEventListener("click",(function(){FASHIONADE.LOGS("wish")}))),$$("#actionBuy").length>0&&$$("#actionBuy")[0].addEventListener("click",(function(){FASHIONADE.LOGS("buy")})),$$("#actionCart").length>0&&$$("#actionCart")[0].addEventListener("click",(function(){FASHIONADE.LOGS("cart")})),$$("#actionWish").length>0&&$$("#actionWish")[0].addEventListener("click",(function(){FASHIONADE.LOGS("wish")}))};document.addEventListener("DOMContentLoaded",(function(){attachLogEventToButtons()}));var init=function(e,n){config.apiUrl=e.apiUrl||"https://www.fashionade.ai/api/v2/recommend-products",config.apiParams.apiKey=e.apiKey,config.apiParams.appKey=e.appKey,config.apiParams.productId=e.productId,config.logExt=n};return{RECOMMEND_INDEX:function(){return RECOMMEND.INDEX},RECOMMEND_LAYER_INDEX:function(){RECOMMEND.LAYER_INDEX},RECOMMEND_DIRECT:RECOMMEND.direct,RECOMMEND_POSITION:RECOMMEND.position,RECOMMEND_LAYER_DIRECT:RECOMMEND.layer_direct,RECOMMEND_LAYER_POSITION:RECOMMEND.layer_position,RECOMMEND_LAYER_REMOVE:RECOMMEND.layer_remove,LOGS:function(e,n){postLogs(e,n)},getParam:getParam,render:function(e){e&&e.productId&&(config.apiParams.productId=e.productId,e&&e.templateWrapId&&e.templateId?render(e.templateWrapId,e.templateId):render())},init:init}}(window);
